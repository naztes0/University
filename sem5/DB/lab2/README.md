# Report
## Предметна область: Система управління нерухомістю (16)

## Завдання

1. Ознайомитись з видами NoSQL баз
2. Враховуючи предметну область, чи буде ефективніше винести частину даних в іншу базу? Навести аргументи
3. Винести частину даних у обрану NoSQL базу, або розширити предметну область такими вимогами, які б робили використання NoSQL доцільним. Реалізувати
4. Реалізувати те ж саме в SQL базі
5. Тестування швидкодії. Порівняти швидкодію відповідних SQL та NoSQL фрагментів баз. NoSQL має відображатись у декілька SQL таблиць
6. Обрати NoSQL базу іншого типу, розібратись і реалізувати базові запити

---

У даній лабораторній роботі був розширений функціонал реляційної бази даних PostgreSQL за допомогою двох NoSQL баз даних для збільшення швидкодії виконання комплексних запитів у системі управління нерухомістю.

---

## 1. Огляд та вибір NoSQL баз даних
У ході досліджень видів NoSQL баз даних було обрано дві технології, що найкраще відповідають потребам системи нерухомості:

**MongoDB** - Document Stores база даних, де використовується ієрархічний принцип збереження

**Redis** - Key - Value Stores база даних, що працює за принципом "ключ-значення" та зберігає дані в оперативній пам'яті. Використовується для кешування.



## 2. Обґрунтування вибору
### Проблема в PostgreSQL
У початковій реалізації моделі PostgreSQL для зберігання динамічних характеристик об'єктів нерухомості (наявність басейну, гаражу, тип опалення, тип інтернету) використовувався патерн **EAV (Entity-Attribute-Value)** через таблицю `property_attributes`.

Для фільтрації об'єктів за кількома критеріями одночасно необхідно було багаторазово виконувати операції **JOIN**. Кількість об'єктів Property була збільшена до **10,000**, а кількість атрибутів до **50,000**, через що час виконання запитів динамічно зростав.
Кожен атрибут у фільтрі потребував окремого JOIN з таблицею property_attributes, що створювало множинні операції об'єднання та сканування однієї таблиці декілька разів.

### Рішення
**Винесення сутності Property** з характеристиками до документо-орієнтованої бази **MongoDB**, залишивши все інше у PostgreSQL для дотримання **ACID** принципів.


## 3. Реалізація проєкту

Реалізований проєкт на **Node.js** з використанням бібліотек `pg`, `mongoose` та `redis`.

**Використані технології:**
- Backend: Node.js
- SQL Database: PostgreSQL
- NoSQL Databases: MongoDB, Redis
- Пакети: dotenv, mongoose, pg, redis

### Структура проєкту

```
lab_code/
├── index.js                    # Головне меню 
├── package.json                
├── package-lock.json           
├── .env                        
├── src/
│   ├── config/
│   │   ├── dbSQL.js           # Підключення PostgreSQL
│   │   ├── mongoDb.js         # Підключення MongoDB
│   │   └── redisDb.js         # Підключення Redis
│   ├── model/
│   │   └── PropertyNoSQL.js   # Mongoose схема для Property
│   └── scripts/
│       ├── migration.js       # Міграція SQL -> MongoDB
│       ├── benchmark.js       # Порівняння швидкодії
│       └── redis.js           # Демонстрація Redis кешування
```


## 4. Реалізація в SQL базі

Для забезпечення ідентичних умов тестування у базі даних PostgreSQL було згенеровано наступний набір даних:

- **10,000** об'єктів нерухомості у таблиці `property`
- **50,000** записів атрибутів у таблиці `property_attributes`
- Використано схему з патерном **EAV** для динамічних атрибутів
  
## 5 Тестування швидкодії

### Інтерактивне меню

Для зручного тестування було реалізовано меню у головному файлі `index.js`:

```
---Real Estate NoSQL Lab ---
1. Doing migration (SQL -> MongoDB)
2. Running Benchmark
3. Redis (Key-Value)
0. Exit
```

### Тестовий сценарій

**Завдання для бенчмарку:** Пошук нерухомості з ціною до $200,000, яка має одночасно три специфічні характеристики:
- Garage: "Yes"
- Internet: "Starlink"
- Heating: "Gas Individual"

Задля знаходження коректного часу для тестування було виконано **100 ітерацій**, де згодом було обраховане середнє значення часу виконання.

### Результати тестування

```
Connected to PropertyAgencyDB1
MongoDB Connected

--- BENCHMARK ---
Task: find all property objects with specific attributes

SQL Average time: 43.6406 ms
NoSQL Average time: 8.4895 ms

--- RESULTS ---
MongoDB 5.1 times faster!
```

Результат свідчить про те, що обробка запиту для об'єктів Property за допомогою MongoDB пришвидшила виконання запиту приблизно у **5 разів**.

## 6. Redis - Key-Value Store

Для додаткової оптимізації було використано базу даних типу **Key-Value — Redis**.

Тяжкі запити фільтрації є доволі реальною ситуацією, і за виконання подібних запитів тисячами користувачів буде неоптимально кожного разу звертатися до SQL або навіть до MongoDB.
Для вирішення даної проблеми було використано Redis, де результати запитів будуть зберігатися у пам'яті з можливістю швидкого отримання.

### Результати тестування Redis

```
--- REDIS ---

--- First request ---
Getting data from SQL
Get data from SQL and written to Redis
Execution time: 103.1128 ms

--- Second request ---
Data get from Redis
Execution time: 0.4889 ms
```


Результати тесту свідчать про те, що використання одного й того ж запиту пришвидшило його виконання майже у **200 разів** (з 103 мс до 0.49 мс).

## Висновок
Реалізована архітектура демонструє, як правильне поєднання різних типів баз даних може значно покращити продуктивність системи, зберігаючи при цьому надійність та консистентність критичних даних.

## Запуск проекту

### Встановлення залежностей

```bash
npm install
```

### Налаштування змінних оточення

Створити файл `.env` з конфігурацією підключень до PostgreSQL, MongoDB та Redis.

### Запуск програми

```bash
npm start
```

